<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách bài viết</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="m-0">Danh sách bài viết</h2>
        <a class="btn btn-primary" th:href="@{/posts/create}">+ Viết bài mới</a>
    </div>

    <!-- Search -->
    <form class="d-flex gap-2 mb-3" th:action="@{/posts}" method="get">
        <input class="form-control form-control-sm w-50"
               name="searchTitle"
               th:value="${searchTitle}"
               placeholder="Nhập tiêu đề cần tìm">
        <button class="btn btn-primary btn-sm">Tìm kiếm</button>
    </form>

    <!-- Empty state -->
    <div class="alert alert-info"
         th:if="${postPage == null or postPage.totalElements == 0}">
        Chưa có bài viết nào.
    </div>

    <!-- List -->
    <div class="table-responsive"
         th:if="${postPage != null and postPage.totalElements > 0}">
        <table class="table table-striped align-middle">
            <thead class="table-light">
            <tr>
                <th style="width: 80px;">ID</th>
                <th>Tiêu đề</th>
                <th>Danh mục</th>
                <th>Tóm tắt</th>
                <th style="width: 190px;">Ngày tạo</th>
                <th style="width: 160px;" class="text-end">Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="p : ${postPage.content}">
                <td th:text="${p.id}">1</td>
                <td>
                    <a th:href="@{/posts/{id}(id=${p.id})}" th:text="${p.title}">Tiêu đề</a>
                </td>
                <td th:text="${p.category != null ? p.category.name : '—'}">—</td>
                <td th:text="${p.summary ?: '—'}">Tóm tắt…</td>
                <td th:text="${p.createdAt != null ? #temporals.format(p.createdAt, 'dd/MM/yyyy HH:mm') : '—'}">
                    01/10/2025 09:00
                </td>
                <td class="text-end">
                    <a class="btn btn-sm btn-outline-secondary"
                       th:href="@{/posts/edit/{id}(id=${p.id})}">Sửa</a>

                    <!-- Nếu bạn có Spring Security CSRF, thêm input _csrf ở đây -->
                    <form th:action="@{/posts/delete/{id}(id=${p.id})}"
                          method="post" class="d-inline">
                        <button type="submit"
                                class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Xoá bài này?')">Xoá</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Footer: showing range + pagination -->
        <div class="d-flex justify-content-between align-items-center">
            <div class="text-muted small"
                 th:with="start=${postPage.number * postPage.size + (postPage.numberOfElements > 0 ? 1 : 0)},
                          end=${postPage.number * postPage.size + postPage.numberOfElements}">
                <span th:text="'Hiển thị ' + ${start} + '–' + ${end} + ' / ' + ${postPage.totalElements}">Hiển thị 1–3 / 10</span>
            </div>

            <nav th:if="${postPage.totalPages > 1}">
                <ul class="pagination pagination-sm mb-0">
                    <!-- Prev -->
                    <li class="page-item" th:classappend="${postPage.first} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/posts(page=${postPage.number - 1}, searchTitle=${searchTitle})}">«</a>
                    </li>

                    <!-- Page numbers -->
                    <li class="page-item"
                        th:each="i : ${#numbers.sequence(0, postPage.totalPages - 1)}"
                        th:classappend="${i == postPage.number} ? 'active'">
                        <a class="page-link"
                           th:text="${i + 1}"
                           th:href="@{/posts(page=${i}, searchTitle=${searchTitle})}">1</a>
                    </li>

                    <!-- Next -->
                    <li class="page-item" th:classappend="${postPage.last} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/posts(page=${postPage.number + 1}, searchTitle=${searchTitle})}">»</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

</div>
</body>
</html>
